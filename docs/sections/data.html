<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="data_files/libs/clipboard/clipboard.min.js"></script>
<script src="data_files/libs/quarto-html/quarto.js"></script>
<script src="data_files/libs/quarto-html/popper.min.js"></script>
<script src="data_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="data_files/libs/quarto-html/anchor.min.js"></script>
<link href="data_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="data_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="data_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="data_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="data_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">



<section id="data" class="level1">
<h1>Data</h1>
<ul>
<li>Sources</li>
<li>Description</li>
<li>Wrangling/cleaning</li>
<li>Spotting mistakes and missing data (could be part of EDA too)</li>
<li>Listing anomalies and outliers (could be part of EDA too)</li>
</ul>
<section id="main-dataset-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="main-dataset-cleaning">Main dataset Cleaning</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load the CSV file into a data frame</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>properties <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="fu">here</span>(),<span class="st">"data/properties.csv"</span>))</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify values causing the issue</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>problematic_values <span class="ot">&lt;-</span> properties<span class="sc">$</span>number_of_rooms[<span class="fu">is.na</span>(<span class="fu">as.numeric</span>(properties<span class="sc">$</span>number_of_rooms))]</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace non-numeric values with NA</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>properties<span class="sc">$</span>number_of_rooms <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9.]"</span>, <span class="st">""</span>, properties<span class="sc">$</span>number_of_rooms))</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove non-numeric characters and convert to numeric</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>properties<span class="sc">$</span>price <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"[^0-9]"</span>, <span class="st">""</span>, properties<span class="sc">$</span>price))</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the dataset to exclude rows with price &lt; 20000</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>properties <span class="ot">&lt;-</span> properties[properties<span class="sc">$</span>price <span class="sc">&gt;=</span> <span class="dv">20000</span>, ]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the dataset to exclude rows with numbers of rooms &lt; 25</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>properties <span class="ot">&lt;-</span> properties[properties<span class="sc">$</span>number_of_rooms <span class="sc">&lt;</span><span class="dv">25</span>, ]</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace incomplete addresses</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>properties<span class="sc">$</span>address <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"^</span><span class="sc">\\</span><span class="st">W*[.,0-]</span><span class="sc">\\</span><span class="st">W*"</span>, <span class="st">""</span>, properties<span class="sc">$</span>address)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>properties_filtered <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(properties)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>year_category <span class="ot">&lt;-</span> <span class="fu">substr</span>(properties_filtered<span class="sc">$</span>year_category, <span class="dv">1</span>, <span class="dv">9</span>)</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming 'year_category' is a column in the 'properties' dataset</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>year_category <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(properties_filtered<span class="sc">$</span>year_category)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Preprocess the number_of_rooms column</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>number_of_rooms <span class="ot">&lt;-</span> <span class="fu">as.character</span>(properties_filtered<span class="sc">$</span>number_of_rooms)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>number_of_rooms <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, properties_filtered<span class="sc">$</span>number_of_rooms)  <span class="co"># Remove non-numeric characters</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>number_of_rooms <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(properties_filtered<span class="sc">$</span>number_of_rooms)       <span class="co"># Convert to numeric</span></span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>number_of_rooms <span class="ot">&lt;-</span> <span class="fu">trunc</span>(properties_filtered<span class="sc">$</span>number_of_rooms)             <span class="co"># Truncate non-integer values</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a><span class="co"># add majuscule to canton</span></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>properties_filtered<span class="sc">$</span>canton <span class="ot">&lt;-</span> tools<span class="sc">::</span><span class="fu">toTitleCase</span>(properties_filtered<span class="sc">$</span>canton)</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(properties_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    price number_of_rooms            address canton property_type floor
1 1800000              65 1844 Villeneuve VD   Vaud     Apartment    eg
2 1980000              55      1820 Montreux   Vaud     Apartment    eg
3  488000              35         1882 Gryon   Vaud     Apartment    eg
4 1755000               7      1820 Montreux   Vaud     Apartment    eg
5  650000              25       1815 Clarens   Vaud     Apartment    eg
6 1490000              45          1260 Nyon   Vaud     Apartment    eg
  year_category
1        0-1919
2        0-1919
3        0-1919
4        0-1919
5        0-1919
6        0-1919</code></pre>
</div>
</div>
</section>
<section id="creating-variable-zip_code-and-merging-with-amtovz_csv_lv95" class="level2">
<h2 class="anchored" data-anchor-id="creating-variable-zip_code-and-merging-with-amtovz_csv_lv95">Creating Variable zip_code and merging with AMTOVZ_CSV_LV95</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(properties_filtered)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    price number_of_rooms            address canton property_type floor
1 1800000              65 1844 Villeneuve VD   Vaud     Apartment    eg
2 1980000              55      1820 Montreux   Vaud     Apartment    eg
3  488000              35         1882 Gryon   Vaud     Apartment    eg
4 1755000               7      1820 Montreux   Vaud     Apartment    eg
5  650000              25       1815 Clarens   Vaud     Apartment    eg
6 1490000              45          1260 Nyon   Vaud     Apartment    eg
  year_category
1        0-1919
2        0-1919
3        0-1919
4        0-1919
5        0-1919
6        0-1919</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> properties_filtered</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">#the address column is like : '1844 Villeneuve VD' and has zip code number in it</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co">#taking out the zip code number and creating a new column 'zip_code'</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="co">#the way to identify the zip code is to identify numbers that are 4 digits long</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>zip_code <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">"</span><span class="sc">\\</span><span class="st">D"</span>, <span class="st">""</span>, df<span class="sc">$</span>address))</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co">#removing the first two number of zip code has more than 4 number</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>zip_code <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>zip_code <span class="sc">&gt;</span> <span class="dv">9999</span>, df<span class="sc">$</span>zip_code <span class="sc">%%</span> <span class="dv">10000</span>, df<span class="sc">$</span>zip_code)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    price number_of_rooms            address canton property_type floor
1 1800000              65 1844 Villeneuve VD   Vaud     Apartment    eg
2 1980000              55      1820 Montreux   Vaud     Apartment    eg
3  488000              35         1882 Gryon   Vaud     Apartment    eg
4 1755000               7      1820 Montreux   Vaud     Apartment    eg
5  650000              25       1815 Clarens   Vaud     Apartment    eg
6 1490000              45          1260 Nyon   Vaud     Apartment    eg
  year_category zip_code
1        0-1919     1844
2        0-1919     1820
3        0-1919     1882
4        0-1919     1820
5        0-1919     1815
6        0-1919     1260</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#read .csv AMTOVZ_CSV_LV95</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>amto <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="fu">here</span>(),<span class="st">"data/AMTOVZ_CSV_LV95.csv"</span>), <span class="at">sep =</span> <span class="st">";"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(amto)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Ortschaftsname  PLZ Zusatzziffer       Gemeindename BFS.Nr Kantonskürzel
1    Aeugst am Albis 8914            0    Aeugst am Albis      1            ZH
2        Aeugstertal 8914            2    Aeugst am Albis      1            ZH
3          Zwillikon 8909            0 Affoltern am Albis      2            ZH
4 Affoltern am Albis 8910            0 Affoltern am Albis      2            ZH
5         Bonstetten 8906            0         Bonstetten      3            ZH
6          Sihlbrugg 6340            4    Hausen am Albis      4            ZH
        E       N Sprache   Validity
1 2679403 1235842      de 2008-07-01
2 2679815 1237404      de 2008-07-01
3 2675280 1238108      de 2008-07-01
4 2676852 1236930      de 2008-07-01
5 2677412 1241078      de 2008-07-01
6 2686082 1230649      de 2008-07-01</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co">#creating a new dataframe with 'Ortschaftsname' as 'City'Place_name', 'PLZ' as 'zip_code' and 'KantonskÃ.rzel' as 'Canton_code'</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>amto_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">City=</span>amto<span class="sc">$</span>Ortschaftsname, <span class="at">zip_code=</span>amto<span class="sc">$</span>PLZ, <span class="at">Canton_code=</span>amto<span class="sc">$</span>Kantonskürzel)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(amto_df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                City zip_code Canton_code
1    Aeugst am Albis     8914          ZH
2        Aeugstertal     8914          ZH
3          Zwillikon     8909          ZH
4 Affoltern am Albis     8910          ZH
5         Bonstetten     8906          ZH
6          Sihlbrugg     6340          ZH</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co">#merge the two dataframes 'df' and 'amto_df' on 'zip_code'</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">merge</span>(df, amto_df, <span class="at">by=</span><span class="st">'zip_code'</span>, <span class="at">all.x=</span><span class="cn">TRUE</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co">#check if there are nan in city</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>df[<span class="fu">is.na</span>(df<span class="sc">$</span>City),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      zip_code    price number_of_rooms
1           25  2200000              10
2           25  2200000              65
3           26  1995000              75
4           26   870490              45
5          322   870000              25
6          322  1295770              45
2253      1200  2450000               6
2254      1200   982130              45
11886     1919  2535730              55
11887     1919   230000              15
11888     1919  1415380              35
11889     1919  1043260              45
11890     1919  2535730              55
17993     2500  1050000              45
17994     2500  1100000               5
17995     2500   887500              55
17996     2500   870500              45
17997     2500  1176820              45
17998     2500  1159550              35
17999     2500  1927050              45
18000     2500   892500              45
18001     2500   887500              45
18002     2500   420000              45
18003     2500   877500              45
18004     2500   885500              55
18005     2500   872500              45
19603     3000  1448610              45
19604     3000  1515060              45
19605     3000   956880              45
19606     3000  1222680              35
19607     3000  1448610              45
19608     3000  1448610              45
19609     3000  1515060              45
19610     3000   820000              55
19611     3000  1222680              35
19612     3000  1590000              55
19613     3000  1448610              45
27169     4000  2100000              65
27170     4000   975000              45
30708     5201   963520              45
33490     6511   584760               3
33927     6547 19935000              55
35207     6602   270000              15
35208     6602  3721200              55
35209     6602  3721200              55
35210     6604  2644710              35
35211     6604  2644710              35
35212     6604  1142940              45
35213     6604   610000              25
35214     6604   810690              35
35215     6604   860000              35
35216     6604   917010              45
35217     6604  1010040              45
40817     6901  3628170              45
40818     6911   877140              55
40819     6911   810690              45
40820     6911   730950              45
40821     6911   465150              35
42848     7133  2246010              35
42861     7135  3575010              65
43231     8000  1295770              35
43232     8000  2100000              45
43233     8000  2495000              55
44144     8238   739000              35
44145     8238   739000              35
44146     8238   716000              35
44147     8238   716000              35
44148     8238   325600               3
44889     8423  2910510              45
44890     8423  2804190              55
47001     9002  3787650              45
47621     9241   724300              35
                                                 address       canton
1                                       1000 Lausanne 25         Vaud
2                                       1000 Lausanne 25         Vaud
3                          Lausanne 26, 1000 Lausanne 26         Vaud
4                                       1000 Lausanne 26         Vaud
5                    Via Cuolm Liung 30d, 7032 Laax GR 2      Grisons
6                       Via Murschetg 29, 7032 Laax GR 2      Grisons
2253                                         1200 Genève       Geneva
2254  Chemin des pralets, 74100 Etrembières, 1200 Genève       Geneva
11886                                      1919 Martigny       Valais
11887                                      1919 Martigny       Valais
11888                                      1919 Martigny       Valais
11889                                      1919 Martigny       Valais
11890                                      1919 Martigny       Valais
17993                    Hohlenweg 11b, 2500 Biel/Bienne         Bern
17994                                   2500 Biel/Bienne         Bern
17995                                   2500 Biel/Bienne         Bern
17996                                   2500 Biel/Bienne         Bern
17997                                   2500 Biel/Bienne         Bern
17998                                   2500 Biel/Bienne         Bern
17999                                        2500 Bienne         Bern
18000                                   2500 Biel/Bienne         Bern
18001                                   2500 Biel/Bienne         Bern
18002                                   2500 Biel/Bienne         Bern
18003                                   2500 Biel/Bienne         Bern
18004                                   2500 Biel/Bienne         Bern
18005                                   2500 Biel/Bienne         Bern
19603                                          3000 Bern         Bern
19604                                          3000 Bern         Bern
19605                                          3000 Bern         Bern
19606                                          3000 Bern         Bern
19607                                          3000 Bern         Bern
19608                                          3000 Bern         Bern
19609                                          3000 Bern         Bern
19610                                          3000 Bern         Bern
19611                                          3000 Bern         Bern
19612                                          3000 Bern         Bern
19613                                          3000 Bern         Bern
27169                                         4000 Basel  Basel-Stadt
27170                                         4000 Basel  Basel-Stadt
30708                                      5201 Brugg AG       Aargau
33490                                     6511 Cadenazzo       Ticino
33927                               Augio 1F, 6547 Augio      Grisons
35207                                       6602 Muralto       Ticino
35208                                       6602 Muralto       Ticino
35209                                       6602 Muralto       Ticino
35210                                       6604 Solduno       Ticino
35211                                       6604 Solduno       Ticino
35212                                       6604 Solduno       Ticino
35213                                       6604 Solduno       Ticino
35214                                       6604 Solduno       Ticino
35215                                       6604 Solduno       Ticino
35216                                       6604 Locarno       Ticino
35217                                       6604 Locarno       Ticino
40817                                        6901 Lugano       Ticino
40818                             6911 Campione d'Italia       Ticino
40819                             6911 Campione d'Italia       Ticino
40820                             6911 Campione d'Italia       Ticino
40821                             6911 Campione d'Italia       Ticino
42848                  Inder Platenga 34, 7133 Obersaxen      Grisons
42861                                       7135 Fideris      Grisons
43231                                        8000 Zürich       Zurich
43232                                        8000 Zürich       Zurich
43233                                        8000 Zürich       Zurich
44144                         8238 Büsingen am Hochrhein Schaffhausen
44145                         8238 Büsingen am Hochrhein Schaffhausen
44146       Junkerstrasse 85, 8238 Büsingen am Hochrhein Schaffhausen
44147       Junkerstrasse 85, 8238 Büsingen am Hochrhein Schaffhausen
44148      Stemmerstrasse 14, 8238 Büsingen am Hochrhein Schaffhausen
44889                      Chüngstrasse 48, 8423 Embrach       Zurich
44890                      Chüngstrasse 60, 8423 Embrach       Zurich
47001                     6900 Lugano 2 Paradiso Caselle       Ticino
47621                                       9241 Kradolf      Thurgau
         property_type floor year_category City Canton_code
1         Single house           1919-1945 &lt;NA&gt;        &lt;NA&gt;
2                Villa           2006-2010 &lt;NA&gt;        &lt;NA&gt;
3                Villa           1961-1970 &lt;NA&gt;        &lt;NA&gt;
4            Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
5            Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
6            Apartment noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
2253  Bifamiliar house           1981-1990 &lt;NA&gt;        &lt;NA&gt;
2254  Bifamiliar house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
11886       Attic flat noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
11887        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
11888        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
11889        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
11890        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
17993     Single house           2001-2005 &lt;NA&gt;        &lt;NA&gt;
17994     Single house           2001-2005 &lt;NA&gt;        &lt;NA&gt;
17995     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
17996     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
17997            Villa           2016-2024 &lt;NA&gt;        &lt;NA&gt;
17998            Villa           2016-2024 &lt;NA&gt;        &lt;NA&gt;
17999     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
18000     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
18001     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
18002        Apartment noteg     1971-1980 &lt;NA&gt;        &lt;NA&gt;
18003     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
18004     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
18005     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
19603        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19604        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19605        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19606        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19607        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19608        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19609        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19610        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19611           Duplex noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
19612        Apartment noteg     1991-2000 &lt;NA&gt;        &lt;NA&gt;
19613        Roof flat noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
27169            Villa           2016-2024 &lt;NA&gt;        &lt;NA&gt;
27170     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
30708        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
33490        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
33927     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
35207        Apartment    eg     1961-1970 &lt;NA&gt;        &lt;NA&gt;
35208     Single house           1981-1990 &lt;NA&gt;        &lt;NA&gt;
35209     Single house           1981-1990 &lt;NA&gt;        &lt;NA&gt;
35210       Attic flat noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
35211        Apartment noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
35212        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
35213        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
35214        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
35215        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
35216        Apartment noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
35217        Apartment noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
40817       Attic flat noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
40818     Single house           1971-1980 &lt;NA&gt;        &lt;NA&gt;
40819        Apartment    eg     1946-1960 &lt;NA&gt;        &lt;NA&gt;
40820        Apartment noteg     1991-2000 &lt;NA&gt;        &lt;NA&gt;
40821        Apartment noteg     1946-1960 &lt;NA&gt;        &lt;NA&gt;
42848     Single house           2006-2010 &lt;NA&gt;        &lt;NA&gt;
42861     Single house              0-1919 &lt;NA&gt;        &lt;NA&gt;
43231     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
43232        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
43233        Apartment noteg        0-1919 &lt;NA&gt;        &lt;NA&gt;
44144        Apartment    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
44145       Attic flat    eg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
44146       Attic flat noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
44147        Apartment noteg     2016-2024 &lt;NA&gt;        &lt;NA&gt;
44148        Apartment noteg     1961-1970 &lt;NA&gt;        &lt;NA&gt;
44889     Single house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
44890 Bifamiliar house           2016-2024 &lt;NA&gt;        &lt;NA&gt;
47001        Apartment noteg     2011-2015 &lt;NA&gt;        &lt;NA&gt;
47621        Apartment noteg     1991-2000 &lt;NA&gt;        &lt;NA&gt;</code></pre>
</div>
</div>
<p>We have 144 NAN, where</p>
<ul>
<li>The zip code was not found in the atmo df</li>
<li>The zip code was incorectly isolated from the address</li>
</ul>
<p>Removed them</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co">#remove the rows with nan in city</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>properties_filtered <span class="ot">&lt;-</span> df[<span class="sc">!</span><span class="fu">is.na</span>(df<span class="sc">$</span>City),]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tax-data-cleaning" class="level2">
<h2 class="anchored" data-anchor-id="tax-data-cleaning">Tax data cleaning</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co">#excel file modified for fribourg and liestal </span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="co"># read csv</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>impots <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">file.path</span>(<span class="fu">here</span>(),<span class="st">"data/statistik-steuerfuesse-np-1995-2023-fr.csv"</span>), <span class="at">sep =</span> <span class="st">","</span>, <span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove last 13 rows</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>impots <span class="ot">&lt;-</span> <span class="fu">head</span>(impots, <span class="sc">-</span><span class="dv">14</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Rename columns</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(impots) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Chefs-lieux cantonaux"</span>, <span class="st">"Impôt cantonal"</span>, <span class="st">"Impôt communal"</span>, <span class="st">"Impôt paroissial Evang. / réform"</span>, <span class="st">"Impôt paroissial Kath. / cath.rom"</span>)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Set row names to the content of the first column</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(impots) <span class="ot">&lt;-</span> impots<span class="sc">$</span><span class="st">`</span><span class="at">Chefs-lieux cantonaux</span><span class="st">`</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Remove the first column (which is now row names)</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>impots1 <span class="ot">&lt;-</span> impots[, <span class="sc">-</span><span class="dv">1</span>, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Set the row names for impots1 the same as impots</span></span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(impots1) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(impots)</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>impots <span class="ot">&lt;-</span> impots1</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(impots1)</span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data to CSV based on here()</span></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(impots, <span class="fu">file.path</span>(<span class="fu">here</span>(),<span class="st">"data/impots.csv"</span>), <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="merging-the-two-datasets" class="level3">
<h3 class="anchored" data-anchor-id="merging-the-two-datasets">Merging the two datasets</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a copy of properties_filtered</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>properties_merged <span class="ot">&lt;-</span> properties_filtered</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through unique canton names in properties_filtered</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (canton_name <span class="cf">in</span> <span class="fu">unique</span>(properties_filtered<span class="sc">$</span>canton)) {</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check if canton_name exists as a row name in impots</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (canton_name <span class="sc">%in%</span> <span class="fu">rownames</span>(impots)) {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Get the corresponding row from impots</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>    impots_row <span class="ot">&lt;-</span> impots[canton_name, ]</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add columns to properties_merged with impots content</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (col_name <span class="cf">in</span> <span class="fu">names</span>(impots)) {</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>      properties_merged[properties_merged<span class="sc">$</span>canton <span class="sc">==</span> canton_name, <span class="fu">paste0</span>(col_name, <span class="st">"_impots"</span>)] <span class="ot">&lt;-</span> impots_row[[col_name]]</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Remove impots_row from memory</span></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rm</span>(impots_row)</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Write data to CSV based on here()</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(properties_merged, <span class="fu">file.path</span>(<span class="fu">here</span>(),<span class="st">"data/properties_merged.csv"</span>), <span class="at">row.names =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>##Dataset used for the rest of the analysis</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>properties_filtered <span class="ot">&lt;-</span> properties_merged</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="cleaning-of-commune-data" class="level2">
<h2 class="anchored" data-anchor-id="cleaning-of-commune-data">Cleaning of commune data</h2>
<p>Replaces NAs in both Taux de couverture social and Political (Conseil National Datas) For Taux de couverture Social: NAs were due to reason “Q” = “Not indicated to protect confidentiality” We replaced the NAs by the average taux de couverture in Switzerland in 2019, which was 3.2%</p>
<p>For Political data: NAs were due to reason “M” = “Not indicated because data was not important or applicable” Therefore, we replaced the NAs by 0</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># il faudra changer le path</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="co"># commune_prep &lt;- read.csv(file.path(here(),"data/commune_data.csv"), sep = ";", header = TRUE, stringsAsFactors = FALSE)</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co"># # We keep only 2019 to have some reference? (2020 is apparently not really complete)</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="co"># commune_2019 &lt;- subset(commune_prep, PERIOD_REF == "2019") %&gt;%</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(c("REGION", "CODE_REGION", "INDICATORS", "VALUE", "STATUS"))</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co"># # delete les lignes ou Status = Q ou M (pas de valeur) et ensuite on enlève la colonne</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co"># commune_2019 &lt;- subset(commune_2019, STATUS == "A") %&gt;%</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="co">#   select(c("REGION", "CODE_REGION", "INDICATORS", "VALUE"))</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="co"># # on enlève les lignes qui sont des aggrégats</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="co"># commune_2019 &lt;- subset(commune_2019, REGION != "Schweiz")</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co"># commune_2019 &lt;- commune_2019 %&gt;%</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="co">#   pivot_wider(names_from = INDICATORS, values_from = VALUE)</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="co"># # Rename columns using the provided map</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a><span class="co"># df_commune &lt;- commune_2019 %&gt;%</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a><span class="co">#   rename(`Population - Habitants` = Ind_01_01,</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Densité de la population` = Ind_01_03,</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Etrangers` = Ind_01_08,</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Part du groupe d'âge 0-19 ans` = Ind_01_04,</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Part du groupe d'âge 20-64 ans` = Ind_01_05,</span></span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Part du groupe d'âge 65+ ans` = Ind_01_06,</span></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Taux brut de nuptialité` = Ind_01_09,</span></span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Taux brut de divortialité` = Ind_01_10,</span></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Taux brut de natalité` = Ind_01_11,</span></span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Taux brut de mortalité` = Ind_01_12,</span></span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Ménages privés` = Ind_01_13,</span></span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Population - Taille moyenne des ménages` = Ind_01_14,</span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Sécurité sociale - Taux d'aide sociale` = Ind_11_01,</span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PLR` = Ind_14_01,</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PDC` = Ind_14_02,</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PS` = Ind_14_03,</span></span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - UDC` = Ind_14_04,</span></span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PEV/PCS` = Ind_14_05,</span></span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PVL` = Ind_14_06,</span></span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PBD` = Ind_14_07,</span></span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PST/Sol.` = Ind_14_08,</span></span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - PES` = Ind_14_09,</span></span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a><span class="co">#          `Conseil national - Petits partis de droite` = Ind_14_10)</span></span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-44"><a href="#cb17-44" aria-hidden="true" tabindex="-1"></a><span class="co"># # If no one voted for a party, set as NA -&gt; replacing it with 0 instead</span></span>
<span id="cb17-45"><a href="#cb17-45" aria-hidden="true" tabindex="-1"></a><span class="co"># df_commune &lt;- df_commune %&gt;%</span></span>
<span id="cb17-46"><a href="#cb17-46" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate_at(vars(starts_with("Conseil national")), ~replace_na(., 0))</span></span>
<span id="cb17-47"><a href="#cb17-47" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-48"><a href="#cb17-48" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-49"><a href="#cb17-49" aria-hidden="true" tabindex="-1"></a><span class="co"># # Removing NAs from Taux de couverture sociale column</span></span>
<span id="cb17-50"><a href="#cb17-50" aria-hidden="true" tabindex="-1"></a><span class="co"># # Setting the mean as the mean for Switzerland in 2019 (3.2%)</span></span>
<span id="cb17-51"><a href="#cb17-51" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_taux_aide_social &lt;- 3.2</span></span>
<span id="cb17-52"><a href="#cb17-52" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb17-53"><a href="#cb17-53" aria-hidden="true" tabindex="-1"></a><span class="co"># # Replace NA values with the mean</span></span>
<span id="cb17-54"><a href="#cb17-54" aria-hidden="true" tabindex="-1"></a><span class="co"># df_commune &lt;- df_commune %&gt;%</span></span>
<span id="cb17-55"><a href="#cb17-55" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(`Sécurité sociale - Taux d'aide sociale` = if_else(is.na(`Sécurité sociale - Taux d'aide sociale`), mean_taux_aide_social, `Sécurité sociale - Taux d'aide sociale`))</span></span>
<span id="cb17-56"><a href="#cb17-56" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>